<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Planning rondier / intervenant — Libercourt</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/png" href="favicon.png?v=2">
<link rel="apple-touch-icon" href="favicon.png?v=2">
<style>
  :root{ --bg:#f7f7f7; --txt:#111; --border:#000; --btn-bg:#fff; --btn-done:#2ecc71; }
  html,body{ margin:0; padding:0; min-height:100vh; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,system-ui,sans-serif; background:linear-gradient(120deg,#f6d365,#fda085); color:#333; }
  .wrap{ max-width:500px; margin:0 auto; padding:12px 14px 18px; }
  header{ display:flex; justify-content:center; align-items:center; padding:2px 0 5px; }
  header img{ max-width:250px; height:auto; display:block; }
  h1{ text-align:center; font-size:18px; margin:8px 0 16px; font-weight:700; }

  .row{ display:grid; grid-template-columns:1fr auto; gap:4px; align-items:center; padding:6px 0; border-bottom:1px dashed rgba(0,0,0,.15); }
  .btn{ display:block; background:var(--btn-bg); color:var(--txt); border:2px solid var(--border); border-radius:1000px; padding:10px 14px; font-weight:600; text-decoration:none; line-height:1; text-align:center; box-shadow:0 1px 0 rgba(0,0,0,.04); touch-action:manipulation; -webkit-tap-highlight-color:transparent; }
  .btn:active{ transform:translateY(1px); }
  .site-btn{ max-width:300px; white-space:normal; margin:0; background-color:#f5f5dc; }
  .time-btn{ min-width:76px; text-align:center; font-size:14px; padding:10px 14px; }
  .time-btn.done{ background:var(--btn-done); color:#fff; border-color:#0e8b47; }

  @media (max-width:420px){
    .wrap{ padding:10px 10px 16px; }
    .row{ gap:4px; }
    .time-btn{ min-width:70px; padding:10px 12px; font-size:13px; }
    .site-btn{ padding:10px 12px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <header><img src="images/logo artemis.png" alt="Logo"></header>
  <h1>Planning — Rondes Libercourt</h1>

  <!-- Exemple -->
  <div class="row">
    <a class="btn site-btn" target="_blank" rel="noopener"
       href="waze://?ll=50.48285,3.01658&navigate=yes">
      Zone industrielle Libercourt<br><small>1 Av. Blaise Pascal</small>
    </a>
    <button class="btn time-btn" data-id="t2115">21:15</button>
  </div>

  <!-- Ajoute tes autres rondes ici... -->

  <!-- Bouton réinitialiser -->
  <div style="text-align:center; margin-top:12px;">
    <button id="reset-btn" class="btn">Réinitialiser les rondes</button>
  </div>
</div>

<script>
  const STORAGE_KEY = "rondesState_libercourt_lv"; // clé spécifique à cette page

  // Web Audio
  const ctx = new (window.AudioContext || window.webkitAudioContext)({ latencyHint: "interactive" });
  function unlockAudio(){ if (ctx.state === "suspended") ctx.resume(); }
  window.addEventListener("pointerdown", unlockAudio, { passive:true });
  window.addEventListener("keydown", unlockAudio, { passive:true });

  async function loadBuffer(url){
    const res = await fetch(url); const arr = await res.arrayBuffer();
    return await ctx.decodeAudioData(arr);
  }

  const buffers = { click:null, success:null };
  let successPlayed = false;

  function play(buf, gainValue = 1.0){
    if (!buf) return;
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const gainNode = ctx.createGain();
    gainNode.gain.value = gainValue;
    src.connect(gainNode).connect(ctx.destination);
    src.start(0);
  }

  function areAllDone(){
    return [...document.querySelectorAll(".time-btn")].every(b => b.classList.contains("done"));
  }

  // LocalStorage : sauvegarde
  function saveState() {
    const states = {};
    document.querySelectorAll(".time-btn").forEach(btn => {
      states[btn.dataset.id] = btn.classList.contains("done");
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(states));
  }

  // LocalStorage : restauration
  function loadState() {
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    document.querySelectorAll(".time-btn").forEach(btn => {
      if (saved[btn.dataset.id]) {
        btn.classList.add("done");
        btn.setAttribute("aria-pressed", "true");
      }
    });
  }

  function toggleBtn(e){
    const btn = e.currentTarget;
    play(buffers.click, 0.5);
    btn.classList.toggle("done");
    btn.setAttribute("aria-pressed", btn.classList.contains("done") ? "true" : "false");
    if (areAllDone()){
      if (!successPlayed){ play(buffers.success, 2.0); successPlayed = true; }
    } else { successPlayed = false; }
    saveState();
  }

  (async function init(){
    [buffers.click, buffers.success] = await Promise.all([
      loadBuffer("sounds/bubble.mp3"),
      loadBuffer("sounds/success.mp3"),
    ]);

    const timeBtns = document.querySelectorAll(".time-btn");
    timeBtns.forEach(btn=>{
      btn.addEventListener("click", toggleBtn);
      btn.setAttribute("role","button");
      btn.setAttribute("aria-pressed","false");
      btn.classList.remove("done");
    });

    loadState(); // restaure au démarrage

    // Bouton reset
    document.getElementById("reset-btn").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      document.querySelectorAll(".time-btn").forEach(btn => {
        btn.classList.remove("done");
        btn.setAttribute("aria-pressed", "false");
      });
    });
  })();
</script>
</body>
</html>
